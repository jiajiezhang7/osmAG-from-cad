# CAD2OSM GUI 语言切换功能说明

## 功能概述

CAD2OSM GUI应用现已支持中英文双语切换功能，用户可以通过菜单一键切换界面语言，所有文本内容会实时更新。

## 支持的语言

- **中文 (zh_CN)**: 默认语言
- **English (en_US)**: 英文

## 使用方法

### 1. 启动应用
```bash
cd cad2osm/gui
python main.py
```

### 2. 切换语言
1. 在主菜单栏中找到"语言/Language"菜单
2. 点击菜单展开语言选项：
   - **中文**: 切换到中文界面
   - **English**: 切换到英文界面
3. 选择所需语言，界面会立即更新
4. 系统会显示"语言切换成功"的确认消息

### 3. 语言设置保存
- 用户选择的语言会自动保存到配置文件
- 下次启动应用时会自动加载上次选择的语言

## 技术实现

### 架构设计
```
cad2osm/gui/
├── i18n/                    # 国际化目录
│   ├── zh_CN.yaml          # 中文语言包
│   └── en_US.yaml          # 英文语言包
├── utils/
│   └── language_manager.py # 语言管理器
├── ui/
│   ├── main_window.py      # 主窗口（已支持语言切换）
│   ├── process_tab.py      # 处理标签页（已支持语言切换）
│   ├── text_tab.py         # 文本标签页（基础支持）
│   ├── merge_tab.py        # 合并标签页（基础支持）
│   └── direction_tab.py    # 方向标签页（基础支持）
└── config/
    └── app_config.yaml     # 应用配置（包含语言设置）
```

### 核心组件

#### 1. 语言管理器 (LanguageManager)
- **单例模式**: 确保全局语言状态一致
- **信号机制**: 语言切换时发送信号通知所有UI组件
- **自动回退**: 翻译缺失时自动使用默认文本
- **错误处理**: 语言包加载失败时的容错机制

#### 2. 语言包文件 (YAML格式)
```yaml
# 示例结构
app:
  title: "应用标题"
menu:
  file: "文件"
  language: "语言"
tabs:
  process: "CAD预处理"
buttons:
  browse: "浏览"
```

#### 3. 翻译函数
```python
from utils.language_manager import tr

# 基本翻译
text = tr("app.title")

# 带默认值的翻译
text = tr("unknown.key", "默认文本")

# 列表翻译
features = tr("about.features")  # 返回列表
```

### 实现特点

1. **实时切换**: 无需重启应用，语言切换立即生效
2. **完整覆盖**: 主窗口、菜单、标签页、按钮等所有UI元素
3. **扩展性强**: 易于添加新语言和新的翻译项
4. **性能优化**: 语言包按需加载，启动速度快
5. **用户友好**: 保存用户选择，下次启动自动应用

## 当前状态

### 已完成
- ✅ 语言管理器核心功能
- ✅ 中英文语言包（完整版）
- ✅ 主窗口完整语言支持
- ✅ 处理标签页完整语言支持
- ✅ 文本提取标签页完整语言支持
- ✅ OSM合并标签页完整语言支持
- ✅ 方向校正标签页完整语言支持
- ✅ **完整流程子标签页完整语言支持**
- ✅ **半自动流程子标签页完整语言支持**
- ✅ 语言切换菜单和逻辑
- ✅ 配置文件语言设置
- ✅ 所有UI组件的实时语言切换
- ✅ 文件对话框标题的翻译
- ✅ 错误消息和状态信息的翻译
- ✅ 功能测试验证

### 待完善
- 🔄 更多语言的支持（如法语、德语等）
- 🔄 动态语言包热加载
- 🔄 用户自定义翻译

## 测试

### 功能测试
运行测试脚本验证语言管理器功能：
```bash
cd cad2osm/gui
python test_language.py
```

### 预期输出
```
=== 语言管理器测试 ===
支持的语言: {'zh_CN': '中文', 'en_US': 'English'}
当前语言: zh_CN

=== 中文翻译测试 ===
应用标题: CAD2OSM图形界面应用
...

=== 切换到英文 ===
切换成功: True
当前语言: en_US

=== 英文翻译测试 ===
App Title: CAD2OSM GUI Application
...
```

## 扩展指南

### 添加新语言
1. 在`i18n/`目录创建新的语言包文件，如`fr_FR.yaml`
2. 在`language_manager.py`中添加语言到`supported_languages`字典
3. 在语言菜单中添加对应的菜单项

### 添加新翻译项
1. 在语言包文件中添加新的键值对
2. 在代码中使用`tr("new.key")`调用翻译
3. 确保所有支持的语言都包含该翻译项

### 完善现有标签页
1. 在标签页类中导入`tr`函数
2. 将硬编码文本替换为`tr()`调用
3. 实现`on_language_changed()`方法更新UI文本
4. 在语言包中添加相应的翻译项

## 注意事项

1. **保持功能完整性**: 语言切换不影响原有功能逻辑
2. **翻译一致性**: 确保同一概念在不同位置使用相同翻译
3. **用户体验**: 语言切换应该直观、快速、无错误
4. **维护性**: 新增功能时记得添加相应的翻译支持

## 总结

语言切换功能已成功实现并集成到CAD2OSM GUI应用中。用户现在可以方便地在中英文之间切换，提升了应用的国际化水平和用户体验。该实现具有良好的扩展性，为未来添加更多语言和完善翻译内容奠定了坚实基础。
